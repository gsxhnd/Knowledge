---
title: Stable Diffusion åŸºç¡€
created: 2024-09-10 15:22
tags:
  - StableDiffusion
---

<!-- markdownlint-disable MD025 -->

# Stable Diffusion åŸºç¡€

## Stable Diffusion æ¦‚è¿°

Stable Diffusionï¼ˆç¨³å®šæ‰©æ•£ï¼‰^[https://stability.ai/stable-image] ä¸¥æ ¼è¯´æ¥å®ƒæ˜¯ä¸€ä¸ªç”±å‡ ä¸ªç»„ä»¶ï¼ˆæ¨¡å‹ï¼‰æ„æˆçš„ç³»ç»Ÿï¼Œè€Œéå•ç‹¬çš„ä¸€ä¸ªæ¨¡å‹ã€‚

æˆ‘ä»¥æœ€å¸¸è§çš„æ–‡ç”Ÿå›¾ä¸ºä¾‹ï¼Œè§£é‡Šä¸‹ Stable Diffusion çš„æ•´ä½“æ¶æ„ï¼Œå’Œå·¥ä½œåŸç†ã€‚

å½“æˆ‘ä»¬è¾“å…¥ä¸€å¥ prompt åï¼Œæ¯”å¦‚â€œCat, standing on the castleâ€ï¼ŒStable Diffusion ä¼šç”Ÿæˆä¸€å¼ çŒ«çŒ«ç«™åœ¨åŸå ¡çš„å›¾ï¼Œçœ‹ä¼¼åªæœ‰ä¸€æ­¥ï¼š

![](https://www.comflowy.com/stable-diffusion-foundation/001.png)

ä½†å®é™…ä¸Šï¼Œæ•´ä¸ªç”Ÿæˆçš„è¿‡ç¨‹ç»è¿‡ä¸‰ä¸ªå¤§çš„æ­¥éª¤ã€‚æˆ‘ä¼šå…ˆæ¦‚æ‹¬åœ°ä»‹ç»è¿™ä¸‰å¤§æ­¥éª¤åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œå…ˆè®©å¤§å®¶å¯¹ Stable Diffusion æœ‰ä¸€ä¸ªæ•´ä½“çš„ç†è§£ï¼Œç„¶åå†ç»†è®²é‡Œé¢çš„ç»†èŠ‚ï¼š

1. é¦–å…ˆï¼Œç”¨æˆ·è¾“å…¥çš„ Prompt ä¼šè¢«ä¸€ä¸ªå« ==Text Encoderï¼ˆæ–‡æœ¬ç¼–è¯‘å™¨ï¼‰== çš„ä¸œè¥¿ç¼–è¯‘æˆä¸€ä¸ªä¸ªçš„è¯ç‰¹å¾å‘é‡ã€‚æ­¤æ­¥éª¤ä¸‹ä¼šè¾“å‡º 77 ä¸ªç­‰é•¿çš„å‘é‡ï¼Œæ¯ä¸ªå‘é‡åŒ…å« 768 ä¸ªç»´åº¦ã€‚åç»­æˆ‘ä¼šå±•å¼€è®²è®²è¿™äº›å‘é‡çš„ä½œç”¨ï¼Œç°åœ¨å„ä½å¯ä»¥ç®€å•å°†å…¶ç†è§£ä¸ºã€Œå°†æ–‡æœ¬è½¬åŒ–ä¸ºæœºå™¨èƒ½è¯†åˆ«çš„å¤šç»„æ•°å­—ã€ã€‚
2. æ¥ç€ï¼Œè¿™äº›ç‰¹å¾å‘é‡ä¼šå’Œä¸€å¼ éšæœºå›¾ï¼ˆå¯ä»¥ç®€å•ç†è§£è¿™æ˜¯ä¸€å¼ å¸ƒæ»¡ç”µå­é›ªèŠ±çš„å›¾ï¼Œæˆ–å……æ»¡ä¿¡æ¯å™ªå£°çš„å›¾ï¼‰ï¼Œä¸€èµ·æ”¾åˆ° Image Information Creator é‡Œã€‚åœ¨è¿™ä¸€æ­¥ï¼Œæœºå™¨ä¼šå°†è¿™äº›ç‰¹å¾å‘é‡å’Œéšæœºå›¾å…ˆè½¬åŒ–åˆ°ä¸€ä¸ª ==Latent Spaceï¼ˆæ½œç©ºé—´ï¼‰== é‡Œï¼Œç„¶åæ ¹æ®è¿™äº›ç‰¹å¾å‘é‡ï¼Œå°†éšæœºå›¾ã€Œé™å™ªã€ä¸ºä¸€ä¸ªã€Œä¸­é—´äº§ç‰©ã€ã€‚ä½ å¯ä»¥ç®€å•ç†è§£ï¼Œæ­¤æ—¶çš„ã€Œä¸­é—´äº§ç‰©ã€æ˜¯äººç±»çœ‹ä¸æ‡‚çš„ã€Œå›¾ã€ï¼Œæ˜¯ä¸€å †æ•°å­—ï¼Œä½†æ­¤æ—¶è¿™ä¸ªä¸­é—´äº§ç‰©æ‰€å‘ˆç°çš„ä¿¡æ¯å·²ç»æ˜¯æ˜¯ä¸€åªç«™åœ¨åŸå ¡ä¸Šçš„çŒ«äº†ã€‚
3. æœ€åï¼Œè¿™ä¸ªä¸­é—´äº§ç‰©ä¼šè¢« ==Image Decoderï¼ˆå›¾ç‰‡è§£ç å™¨ï¼‰== è§£ç æˆä¸€å¼ çœŸæ­£çš„å›¾ç‰‡ã€‚

å¦‚æœå°†ä»¥ä¸Šçš„ä¸‰å¤§æ­¥éª¤å¯è§†åŒ–çš„è¯ï¼Œä¼šæ˜¯è¿™æ ·ï¼š
![](https://www.comflowy.com/stable-diffusion-foundation/002.png)

æ€»ç»“ä¸€ä¸‹ï¼Œç®€å•ç†è§£ï¼Œå°±æ˜¯ç”¨æˆ·è¾“å…¥äº†ä¸€æ®µ Prompt æŒ‡ä»¤ï¼Œæœºå™¨ä¼šæŒ‰ç…§è¿™ä¸ªæŒ‡ä»¤ï¼Œåœ¨ä¸€ä¸ªæ½œç©ºé—´é‡Œï¼Œå°†ä¸€å¼ éšæœºå›¾é™å™ªä¸ºä¸€å¼ ç¬¦åˆæŒ‡ä»¤çš„å›¾ç‰‡ã€‚

æ•´ä¸ªè¿‡ç¨‹ï¼Œä¸å…¶è¯´ AI æ˜¯åœ¨ã€Œç”Ÿæˆã€å›¾ç‰‡ï¼Œä¸å¦‚ç§°å…¶ä¸ºã€Œé›•åˆ»ã€æ›´åˆé€‚ã€‚å°±åƒç±³å¼€æœ—åŸºç½—åœ¨å®Œæˆå¤§å«é›•åƒåï¼Œè¯´è¿‡çš„ä¸€å¥è¯é‚£æ ·ï¼šé›•åƒæœ¬æ¥å°±åœ¨çŸ³å¤´é‡Œï¼Œæˆ‘åªæ˜¯æŠŠä¸è¦çš„éƒ¨åˆ†å»æ‰ã€‚

æ‰€æœ‰å›¾ç‰‡éƒ½å­˜åœ¨äº†ä¸€å¼ å……æ»¡å™ªç‚¹çš„å›¾ç‰‡é‡Œï¼ŒAI åªæ˜¯æŠŠä¸è¦çš„éƒ¨åˆ†å»æ‰äº†ã€‚æ‰€ä»¥å¦‚æœä½ ç”¨åŒæ ·æ˜¯ Diffusion Model æ­å»ºçš„ Midjourney è¯ï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä¸‹çš„è¿‡ç¨‹ï¼Œé¦–å…ˆæ˜¯ä¸€å¼ æ¨¡ç³Šç”šè‡³é»‘è‰²çš„å›¾ç‰‡ï¼Œç„¶åå›¾ç‰‡ä¼šä¸€æ­¥æ­¥å˜å¾—è¶Šæ¥è¶Šæ¸…æ™°ï¼Œè¿™å°±æ˜¯æˆ‘å‰é¢æ‰€è¯´çš„ã€Œé™å™ªã€æˆ–è€…ã€Œé›•åˆ»ã€çš„è¿‡ç¨‹ï¼š![](https://www.comflowy.com/stable-diffusion-foundation/004.png)

## Image Information Creator

æ—¢ç„¶è¯´åˆ°é™å™ªï¼Œæˆ‘ä»¬å°±æ¥å±•å¼€è®²è®²æ•´ä¸ªã€Œé™å™ªã€çš„è¿‡ç¨‹ã€‚

é¦–å…ˆæ•´ä¸ªé™å™ªçš„è¿‡ç¨‹ä¼šåœ¨ä¸€ä¸ª ==Latent Spaceï¼ˆæ½œç©ºé—´ï¼‰== é‡Œè¿›è¡Œï¼Œç„¶åä¼šè¿›è¡Œå¤š ==Stepsï¼ˆæ­¥ï¼‰== çš„é™å™ªï¼Œä½ å¯ä»¥å¯¹è¿™ä¸ª Steps è¿›è¡Œè°ƒæ•´ï¼Œä¸€èˆ¬è¶Šå¤šå›¾ç‰‡è´¨é‡ä¹Ÿä¼šå¥½ï¼Œä½†æ—¶é—´ä¹Ÿä¼šè¶Šä¹…ã€‚å½“ç„¶è¿™ä¸ªä¹Ÿè·Ÿæ¨¡å‹æœ‰å…³ï¼ŒStable Diffusion XL Turbo å°±èƒ½ 1 æ­¥å‡ºå›¾ï¼Œè€—æ—¶ä¸åˆ° 1 ç§’ï¼Œè€Œä¸”ç”Ÿæˆçš„å›¾ç‰‡è´¨é‡è¿˜å¾ˆä¸é”™ã€‚å¦‚æœæˆ‘ä»¬å°†è¿™ä¸€æ­¥è¿‡ç¨‹å¯è§†åŒ–ï¼Œç±»ä¼¼æ˜¯è¿™æ ·çš„ï¼ˆä¸ºäº†æ›´å¥½åœ°è§£é‡Šï¼Œæˆ‘å°†ä¸‹æ–¹é»‘è‰²çš„å—éƒ½æè¿°æˆå›¾ï¼Œæœ¬è´¨ä¸Šå®ƒä¸æ˜¯å›¾ï¼Œåªæ˜¯ä¸€å †ä¸å›¾åƒç›¸å…³çš„æ•°æ®ï¼‰ï¼š

é‚£ Denoise é‡Œåˆå‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿä¸‹å›¾æ˜¯ç¬¬ä¸€ä¸ª Denoise è¿‡ç¨‹çš„å¯è§†åŒ–ï¼š
![](https://www.comflowy.com/stable-diffusion-foundation/003.png)

ä¸Šå›¾çœ‹ä¸Šå»å¾ˆå¤æ‚ï¼Œä½†ä¸è¦ææƒ§ï¼Œæˆ‘ä»¬åªè¦æ‡‚åŠ å‡ä¹˜é™¤å°±èƒ½ç†è§£æ¯ä¸ª Denoiseï¼š
![](https://www.comflowy.com/stable-diffusion-foundation/005.png)

- é¦–å…ˆï¼Œåœ¨ Denoise é‡Œæœ‰ä¸€ä¸ª Noise Predictorï¼ˆå™ªéŸ³é¢„æµ‹å™¨ï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒå°±æ˜¯èƒ½é¢„æµ‹å‡ºéšæœºå›¾é‡ŒåŒ…å«ä»€ä¹ˆå™ªéŸ³çš„æ¨¡å‹ã€‚é™¤äº†è¾“å…¥éšæœºå›¾å’Œ Prompt çš„è¯ç‰¹å¾å‘é‡å¤–ï¼Œè¿˜éœ€è¦è¾“å…¥å½“å‰çš„ Step æ•°ã€‚è™½ç„¶åœ¨ä¸Šé¢çš„å¯è§†åŒ–æµç¨‹ä¸­ï¼Œä½ ä¼šçœ‹åˆ°å¾ˆå¤šä¸ª Denoiseï¼Œä½†å®é™…ç¨‹åºè¿è¡Œçš„æ˜¯åŒä¸€ä¸ª Denoiseï¼Œæ‰€ä»¥éœ€è¦å°† Step å‘ŠçŸ¥ Noise Predictor è®©å…¶çŸ¥é“æ­£åœ¨è¿›è¡Œå“ªä¸€æ­¥çš„é¢„æµ‹ã€‚
- ç„¶åï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹æ©™è‰²çš„çº¿ï¼ŒNoise Predictor ä¼šä½¿ç”¨éšæœºå›¾ï¼ˆæ¯”å¦‚ä¸€å¼  4 X 4 çš„å›¾ï¼‰å’Œ Prompt çš„è¯ç‰¹å¾å‘é‡é¢„æµ‹å‡ºä¸€å¼ å™ªå£°å›¾ Bã€‚æ³¨æ„ï¼Œè¿™é‡Œä¸æ˜¯æ ¹æ®é¢„æµ‹è¾“å‡ºå®é™…çš„å›¾ï¼Œè€Œæ˜¯ä¸€å¼ å™ªå£°å›¾ã€‚æ¢å¥è¯æ¥è¯´ï¼ŒNoise Predictor æ˜¯æ ¹æ®è¯å‘é‡é¢„æµ‹è¿™å¼ éšæœºå›¾é‡Œæœ‰å“ªäº›ä¸éœ€è¦çš„å™ªå£°ã€‚å¦‚æœæ‹¿å‰é¢çš„é›•åˆ»çš„ä¾‹å­æ¥ç±»æ¯”ï¼Œå®ƒè¾“å‡ºçš„æ˜¯é›•åˆ»é›•åƒæ‰€ä¸éœ€è¦çš„åºŸæ–™ã€‚äºæ­¤åŒæ—¶ï¼ŒNoise Predictor è¿˜ä¼šä½¿ç”¨ä¸åŒ…å« Prompt çš„è¯ç‰¹å¾å‘é‡é¢„æµ‹å‡ºä¸€å¼ å™ªéŸ³å›¾ Cï¼ˆä¹Ÿå°±æ˜¯å›¾ä¸­çš„è“è‰²çº¿ï¼‰ã€‚

  > [!faq] dasd
  > ä½ å¯èƒ½å¥½å¥‡ï¼Œä¸ºä½•æˆ‘è¦é«˜äº® 4 X 4ï¼Ÿå›çœ‹å®Œæ•´çš„ Denoise çš„æµç¨‹ï¼Œä½ ä¼šå‘ç°ï¼Œå¼€å§‹çš„æ—¶å€™ï¼Œéšæœºå›¾æ˜¯ 4 X 4ï¼Œç»“æœä¹Ÿæ˜¯ 4 X 4ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœä½ æƒ³è¦æ”¹å˜æœ€ç»ˆç”Ÿæˆå›¾åƒçš„æ¯”ä¾‹ï¼Œæˆ–è€…æ˜¯å¤§å°ï¼Œä½ éœ€è¦ä¿®æ”¹è¿™ä¸ªéšæœºå›¾çš„æ¯”ä¾‹æˆ–å¤§å°ï¼Œè€Œä¸æ˜¯é€šè¿‡ Prompt ä¸‹è¾¾è°ƒæ•´çš„æŒ‡ä»¤ã€‚ç”¨é›•åˆ»æ¥ç±»æ¯”ï¼Œä¼šå¾ˆå¥½ç†è§£ï¼Œç”¨ 1 ç«‹æ–¹ç±³çš„çŸ³å¤´è¿›è¡Œé›•åˆ»ï¼Œä¸ç®¡é›•åˆ»å¸ˆæŠ€è‰ºæœ‰å¤šå¥½ï¼Œéƒ½æ²¡æ³•é›•åˆ»å‡ºä¸€ä¸ªé«˜ 10 ç±³çš„é›•åƒã€‚å®ƒæœ€å¤šåªèƒ½é›•åˆ»ä¸€ä¸ªé«˜ 1 ç±³çš„é›•åƒã€‚

- æ¥ç€ï¼ŒDenoise ä¼šæ‹¿å™ªéŸ³å›¾ B å’Œ C ç›¸å‡å¾—å‡ºå›¾ Dã€‚æˆ‘ä»¬ç”¨ç®€å•çš„æ•°å­¦è§£é‡Šä¸‹è¿™å¼ å›¾æ˜¯å•¥ã€‚é¦–å…ˆï¼Œå›¾ B æ˜¯ç”¨ Prompt åŠ éšæœºå›¾é¢„æµ‹çš„å™ªå£°ï¼Œç®€å•ç†è§£ï¼Œå°±åŒ…å«äº†ã€Œæ ¹æ® Prompt é¢„æµ‹çš„å™ªå£°ã€+ã€Œæ ¹æ®éšæœºå›¾é¢„æµ‹çš„å™ªå£°ã€ï¼Œè€Œ C åˆ™æ˜¯ã€Œæ ¹æ®éšæœºå›¾é¢„æµ‹çš„å™ªå£°ã€ï¼ŒB å‡ C å°±ç­‰äºã€Œæ ¹æ® Prompt é¢„æµ‹çš„å™ªå£°ã€ã€‚
- å†ä¹‹åï¼ŒDenoise ä¼šå°† D å™ªå£°æ”¾å¤§ï¼Œä¸€èˆ¬å°±æ˜¯ä¼šä¹˜ä»¥ä¸€ä¸ªç³»æ•°ï¼Œè¿™ä¸ªç³»æ•°åœ¨ä¸€äº› Stable Diffusion é‡Œä¼šä»¥ ==CFGã€CFG Scale æˆ–è€… Guidance Scale== è¡¨ç¤ºã€‚æ¥ç€å†æ‹¿è¿™å¼ æ”¾å¤§åçš„å›¾ä¸å™ªå£°å›¾ C ç›¸åŠ ï¼Œå¾—åˆ°å›¾ Eã€‚è¿™æ ·åšçš„åŸå› æ˜¯ä¸ºäº†æé«˜å›¾ç‰‡ç”Ÿæˆçš„å‡†ç¡®æ€§ï¼Œæ‰€ä»¥é€šè¿‡ä¹˜ä»¥ä¸€ä¸ªç³»æ•°ï¼Œæ¥åˆ»æ„æé«˜ã€Œæ ¹æ® Prompt é¢„æµ‹çš„å™ªå£°ã€çš„æƒé‡ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸€æ­¥ï¼Œç”Ÿæˆçš„å›¾ç‰‡å°±è·Ÿ Prompt æ²¡é‚£ä¹ˆç›¸å…³äº†ã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿè¢«ç§°ä¸º Classifier Free Guidanceï¼ˆæ— åˆ†ç±»å¼•å¯¼æ³•ï¼‰ã€‚

> [!faq]
> å¦‚æœä½ æœ‰ç”¨è¿‡ Stable Diffusion çš„å·¥å…·ï¼Œä½ ä¼šå‘ç° Prompt çš„è¾“å…¥æ¡†æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ­£å‘çš„ï¼Œä¸€ä¸ªè´Ÿå‘çš„ã€‚é‚£è´Ÿå‘çš„ Prompt æ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„å‘¢ï¼Ÿç”¨ä¸Šè¿°çš„æ•°å­¦æ–¹æ³•ï¼Œç®€å•ç†è§£ï¼Œå½“è¾“å…¥è´Ÿå‘çš„ Prompt çš„æ—¶å€™ï¼Œä¹Ÿä¼šç”Ÿæˆä¸€å¼ å™ªå£°å›¾ B2ï¼Œä½†æ­¤æ—¶æˆ‘ä»¬ä¼šç”¨æ­£å‘çš„ Prompt ç”Ÿæˆçš„å™ªå£°å›¾ B1 å‡å» B2 å†å‡å» C å¾—å‡º Dï¼Œé‚£å°±æ„å‘³ç€æœ€ç»ˆç”Ÿæˆçš„å›¾ç‰‡ä¼šæ›´åŠ è¿œç¦» B2ï¼Œå› ä¸ºå‡æ‰äº†æ›´å¤šä¸ B2 ç›¸å…³çš„å™ªå£°ã€‚

> [!info]
> ä½ å¯èƒ½å¥½å¥‡ä¸ºä½•æ˜¯ã€Œé™å™ªã€è€Œä¸æ˜¯å…¶ä»–æ–¹å¼ï¼Ÿä½ å¯ä»¥æŸ¥çœ‹ Stable Diffusion è¿›é˜¶ã€‚

## Image Decoder

æ¥ç€æˆ‘ä»¬å†æ¥èŠä¸‹ Latent Spaceï¼ˆæ½œç©ºé—´ï¼‰ã€‚æˆ‘åœ¨å­¦ä¹ è¿™ä¸ªæ¦‚å¿µçš„æ—¶å€™ï¼Œæœ€å¤§çš„ç–‘æƒ‘å°±æ˜¯ä¸ºä½•è¦åœ¨æ½œç©ºé—´é‡Œè¿›è¡Œï¼Ÿè€Œä¸æ˜¯ç›´æ¥ç”¨å›¾ç‰‡è¿›è¡Œå»å™ªï¼Ÿ

è¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆè¦ç†è§£ä»€ä¹ˆæ˜¯æ½œç©ºé—´ï¼Ÿ

æ½œåœ¨ç©ºé—´æ˜¯æŒ‡åœ¨æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ ä¸­ï¼Œç”¨äºè¡¨ç¤ºæ•°æ®çš„ä½ç»´ç©ºé—´ã€‚å®ƒæ˜¯é€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡Œç¼–ç å’Œé™ç»´å¾—åˆ°çš„ä¸€ç»„æ½œåœ¨å˜é‡ã€‚æ½œåœ¨ç©ºé—´çš„ç»´åº¦é€šå¸¸æ¯”åŸå§‹æ•°æ®çš„ç»´åº¦ä½ï¼Œå› æ­¤å¯ä»¥æå–å‡ºæ•°æ®ä¸­æœ€é‡è¦çš„ç‰¹å¾å’Œç»“æ„ã€‚

çœ‹ä¸Šå»å¾ˆå¤æ‚ï¼Œç®€å•ç†è§£å°±æ˜¯æ½œç©ºé—´ä¼šå°†å›¾ç‰‡ç¼–ç æˆä¸€å †æ•°å­—ï¼ŒåŒæ—¶å¯¹è¿™äº›æ•°å­—è¿›è¡Œå‹ç¼©ã€‚è®©æˆ‘ä»¬é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼çœ‹çœ‹è¿™ä¸ªè¿‡ç¨‹ï¼š

![](https://www.comflowy.com/stable-diffusion-foundation/006.png)

å›¾ç‰‡ä¼šå…ˆè¢«ä¸€ä¸ª Image Encoder ç¼–ç æˆä¸€ç»„æ•°æ®ï¼Œå¹¶è¢«å‹ç¼©ï¼Œå¦‚æœç”¨åƒç´ çš„è§’åº¦æ¥è¡¡é‡è¿™ä¸ªæ•°æ®å‹ç¼©çš„æ•ˆæœï¼ŒåŸå›¾å¯èƒ½æ˜¯ä¸€å¼  512 X 512 çš„å›¾ï¼Œå‹ç¼©åå˜æˆäº† 64 X 64ï¼Œæ•°æ®æå¤§åœ°å‡å°‘äº†ï¼Œæœ€åå†ä½¿ç”¨ Image Decoder è¿˜åŸå³å¯ã€‚è€Œè¿™ä¸ª Encoder åŠ  Decoder çš„ç»„ä»¶ï¼Œä¹Ÿè¢«ç§°ä¸º Variational Auto Encoderï¼ˆå˜åˆ†è‡ªç¼–ç å™¨ï¼‰ç®€ç§° ==VAE== ã€‚æ‰€ä»¥è¿™ä¸ª Image Decoder åœ¨ä¸€äº›äº§å“é‡Œï¼Œä¹Ÿå« VAE Decoderã€‚

é‚£ä½¿ç”¨è¿™ä¸ªæŠ€æœ¯æœ‰ä»€ä¹ˆå¥½å¤„å’Œåå¤„å‘¢ï¼Ÿ

å¥½å¤„ï¼š

- é¦–å…ˆå½“ç„¶æ˜¯æ•ˆç‡æå‡äº†éå¸¸å¤šã€‚ä½¿ç”¨ VAE åï¼Œå³ä½¿æ°‘ç”¨çš„ GPU ä¹Ÿèƒ½ä»¥ç›¸å¯¹è¾ƒå¿«çš„é€Ÿåº¦ï¼Œå®Œæˆé™å™ªè¿ç®—ã€‚åŒæ—¶è®­ç»ƒæ¨¡å‹çš„æ—¶é—´ä¹Ÿä¼šæ›´çŸ­ã€‚
- å¦å¤–ï¼Œæ½œåœ¨ç©ºé—´çš„ç»´åº¦é€šå¸¸æ¯”åŸå§‹å›¾åƒçš„ç»´åº¦ä½å¾—å¤šï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥æ›´æœ‰æ•ˆåœ°è¡¨ç¤ºå›¾åƒçš„ç‰¹å¾ã€‚é€šè¿‡åœ¨æ½œåœ¨ç©ºé—´ä¸­è¿›è¡Œæ“ä½œå’Œæ’å€¼ï¼Œå¯ä»¥å¯¹å›¾åƒè¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶å’Œç¼–è¾‘ã€‚è¿™ä½¿å¾—åœ¨ç”Ÿæˆå›¾åƒæ—¶å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å›¾åƒçš„ç»†èŠ‚å’Œé£æ ¼ï¼Œä»è€Œæé«˜ç”Ÿæˆå›¾åƒçš„è´¨é‡å’Œé€¼çœŸåº¦ã€‚

åå¤„ï¼š

- ç»è¿‡ç¼–ç ï¼Œç„¶åå†å°†æ•°æ®è¿˜åŸä¼šå¯¼è‡´ä¸€äº›æ•°æ®ä¸¢å¤±ã€‚è€Œä¸”åŠ ä¸Šæ½œåœ¨ç©ºé—´çš„ç»´åº¦è¾ƒä½ï¼Œå®ƒå¯èƒ½æ— æ³•å®Œå…¨æ•æ‰åŸå§‹æ•°æ®ä¸­çš„æ‰€æœ‰ç»†èŠ‚å’Œç‰¹å¾ã€‚æœ€ç»ˆå¯¼è‡´è¿˜åŸçš„å›¾ç‰‡æ¯”è¾ƒå¥‡æ€ªã€‚

> [!faq]
> ä¸ºä½• Stable Diffusion ç”Ÿæˆçš„å›¾ç‰‡ä¸­ï¼Œæ–‡å­—ä¸€èˆ¬éƒ½å¾ˆè¯¡å¼‚ï¼Ÿå› ä¸ºåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸€æ–¹é¢æ˜¯æ–‡å­—çš„ä¸€äº›ç»†èŠ‚ç‰¹å¾ä¸¢å¤±äº†ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨é¢„æµ‹å™ªéŸ³çš„æ—¶å€™ï¼Œæ–‡å­—çš„é¢„æµ‹ä¸å›¾åƒçš„é¢„æµ‹ç›¸æ¯”ï¼Œä¸é‚£ä¹ˆè¿è´¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œé¢„æµ‹çŒ«çš„ç‰¹å¾æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œå› ä¸ºçŒ«å¤§æ¦‚ç‡æœ‰ 2 ä¸ªçœ¼ç›ï¼Œçœ¼ç›ä¸‹é¢æ˜¯é¼»å­ï¼Œå®ƒæ˜¯è¿è´¯çš„ã€‚ä½†è‹±æ–‡ã€ŒCatã€å’Œä¸­æ–‡ã€ŒçŒ«ã€ä¸¤ä¸ªå°±æœ‰å¾ˆå¤§å·®åˆ«ï¼Œä¸”å¾ˆéš¾é¢„æµ‹ï¼Œæ¯”å¦‚ä¸­æ–‡çš„ç¬”ç”»å¤§æ¦‚ç‡ç”±æ¨ªç«–å‹¾æ’‡æºç»„æˆï¼Œä½†å¦‚ä½•é¢„æµ‹æ’‡ä¹‹åæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

## Text Encoder

åœ¨æœ€å‰é¢çš„æµç¨‹ä¸­ï¼Œæˆ‘æåˆ°è¿‡ï¼ŒText Encoderï¼ˆæ–‡æœ¬ç¼–è¯‘å™¨ï¼‰ä¼šå°†ä½ è¾“å…¥çš„ Prompt ç¼–è¯‘æˆä¸€ä¸ªä¸ªçš„è¯ç‰¹å¾å‘é‡ã€‚æ­¤æ­¥éª¤ä¸‹ä¼šè¾“å‡º 77 ä¸ªç­‰é•¿çš„å‘é‡ï¼Œæ¯ä¸ªå‘é‡åŒ…å« 768 ä¸ªç»´åº¦ã€‚è¿™äº›å‘é‡é‡Œåˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´æœ‰è¶£çš„é—®é¢˜ï¼Œå½“æˆ‘ä»¬åœ¨ Prompt é‡Œåªè¾“å…¥ Catï¼Œå¹¶æ²¡æœ‰åœ¨ Prompt é‡ŒåŠ ä¸Š orangeï¼Œé‚£ä¸ºä½•æœ€åè¾“å‡ºçš„çŒ«æ˜¯æ©˜è‰²çš„å‘¢ï¼Ÿè¦å›ç­”è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ Text Encoder çš„å®ç°ã€‚

ç›®å‰ Stable Diffusion å¸¸ç”¨çš„ Text Encoder ç”¨çš„æ˜¯ [OpenAI å¼€æº](https://openai.com/index/clip/) çš„ CLIP æ¨¡å‹ï¼Œå…¨ç§°ä¸º Contrastive Language Image Pre-trainingï¼ˆå¯¹æ¯”è¯­è¨€å›¾åƒé¢„è®­ç»ƒï¼‰ã€‚æˆ‘ä»¬ç…§ä¾‹å…ˆç”»ä¸ªå›¾ï¼š

![](https://www.comflowy.com/stable-diffusion-foundation/007.png)

é¦–å…ˆï¼Œè¿™ä¸ª CLIP ä¹Ÿæœ‰ä¸€ä¸ª Text Encoderï¼Œä¼šå°†æ–‡æœ¬è½¬åŒ–ä¸ºä¸€ä¸ªç‰¹å¾å‘é‡ï¼Œç„¶åå®ƒè¿˜æœ‰ä¸€ä¸ª Image Encoder ä¼šå°†å›¾ç‰‡ä¹Ÿè½¬æˆå„ç§ç‰¹å¾å‘é‡ã€‚å¦‚æœè¿™ä¸¤ä¸ªå‘é‡è¶Šè¿‘ï¼Œæ„å‘³ç€è¿™ä¸ªæè¿°ï¼Œè¶Šæ¥è¿‘å›¾ç‰‡çš„å†…å®¹ï¼›åä¹‹è¶Šè¿œï¼Œåˆ™è¶Šä¸ç›¸å…³ã€‚

OpenAI ä½¿ç”¨äº† 4 äº¿ç»„å›¾ç‰‡æ–‡æœ¬å¯¹ï¼Œå¯¹æ­¤æ¨¡å‹è¿›è¡Œäº†è®­ç»ƒï¼Œæœ€åè®­ç»ƒå‡ºæ¥çš„ CLIP æ¨¡å‹æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å½“æˆ‘ä»¬è¾“å…¥å›¾ç‰‡çš„æè¿°æ—¶ï¼ŒCLIP èƒ½åˆ¤æ–­å‡ºä¸è¿™ä¸ªæè¿°æœ€ç›¸è¿‘çš„å›¾ç‰‡æ˜¯å“ªå¼ ã€‚æ¯”å¦‚ä¸‹å›¾ä¸­ç¬¬å››è¡Œï¼Œæè¿°æ˜¯ã€Œä¸€å¼ æ–‘ç‚¹çŒ«é¢éƒ¨ç…§ç‰‡ã€ï¼Œå®ƒä¸çºµå‘ç¬¬å››å¼ å›¾æœ€ç›¸å…³ï¼Œç›¸ä¼¼åº¦è¾¾åˆ° 0.31ï¼Œä¸ç¬¬ä¸€å¼ ä¹¦æœ¬çš„æˆªå›¾ç›¸ä¼¼åº¦åªæœ‰ 0.12ã€‚

![](https://www.comflowy.com/stable-diffusion-foundation/008.png)

æˆ‘ä»¬å›åˆ° Stable Diffusionï¼Œåœ¨ Stable Diffusion é‡Œï¼Œæˆ‘ä»¬åªä½¿ç”¨äº† CLIP çš„ Text Encoder çš„éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒèƒ½å°†æ–‡æœ¬è½¬åŒ–æˆå¯¹åº”æ–‡æœ¬çš„ç‰¹å¾å‘é‡ï¼Œå¹¶ä¸”è¿™äº›ç‰¹å¾å‘é‡ä¸ç°å®å­˜åœ¨çš„å›¾ç‰‡ä¼šæœ‰ç›¸å…³æ€§ã€‚

å›åˆ°å‰é¢æåˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œå…¶å®ä»–ä»¬äº’ä¸ºå¯¹æ–¹çš„ç­”æ¡ˆ ğŸ˜

ä¸ºä½•å½“æˆ‘ä»¬è¾“å…¥ Cat çš„æ—¶å€™ï¼Œç”Ÿæˆçš„å›¾å¤§æ¦‚ç‡æ˜¯ä¸€åªæ©˜çŒ«æˆ–è€…æ–‘ç‚¹çŒ«ï¼Ÿå› ä¸º Text Encoder å°† Cat è½¬åŒ–æˆ 77 ä¸ªç­‰é•¿çš„å‘é‡ Embedding é‡Œä¼šåŒ…å«ä¸ Cat ç›¸å…³çš„ä¸€äº›ç‰¹å¾å’Œå«ä¹‰ï¼š

- å½¢æ€ç‰¹å¾ï¼šå‘é‡è¡¨ç¤ºå¯èƒ½ä¼šæ•æ‰åˆ° Cat çš„å½¢æ€ç‰¹å¾ï¼Œæ¯”å¦‚å®ƒçš„ä½“å‹ã€å¤´éƒ¨çš„å½¢çŠ¶ã€å››è‚¢çš„ä½ç½®ç­‰ã€‚è¿™äº›ç‰¹å¾å¯ä»¥å¸®åŠ©åŒºåˆ† Cat ä¸å…¶ä»–åŠ¨ç‰©æˆ–ç‰©ä½“ã€‚

- è§†è§‰ç‰¹å¾ï¼šå‘é‡è¡¨ç¤ºå¯èƒ½ä¼šåŒ…å« Cat çš„è§†è§‰ç‰¹å¾ï¼Œæ¯”å¦‚å®ƒçš„é¢œè‰²ã€æ–‘çº¹ã€çœ¼ç›çš„å½¢çŠ¶ç­‰ã€‚è¿™äº›ç‰¹å¾å¯ä»¥å¸®åŠ©è¯†åˆ« Cat çš„å¤–è§‚ç‰¹ç‚¹ã€‚

- è¯­ä¹‰å«ä¹‰ï¼šå‘é‡è¡¨ç¤ºå¯èƒ½ä¼šåŒ…å«ä¸ Cat ç›¸å…³çš„è¯­ä¹‰å«ä¹‰ï¼Œæ¯”å¦‚å®ƒæ˜¯ä¸€ç§å® ç‰©ã€ä¸€ç§ç‹¬ç«‹çš„åŠ¨ç‰©ã€ä¸äººç±»æœ‰äº²å¯†å…³ç³»ç­‰ã€‚è¿™äº›å«ä¹‰å¯ä»¥å¸®åŠ©ç†è§£ Cat åœ¨äººç±»æ–‡åŒ–å’Œç¤¾ä¼šä¸­çš„è§’è‰²å’Œæ„ä¹‰ã€‚

> [!warn]
> æ³¨æ„ï¼šå› ä¸ºæ¨¡å‹æœ‰äº›åœ°æ–¹å…·æœ‰ä¸å¯è§£é‡Šæ€§ï¼Œæ‰€ä»¥å®é™…ä¸Šè¿™äº›å‘é‡ä¸ä¸€å®šåŒ…å«è¿™äº›ç‰¹å¾ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ›´å¥½åœ°è§£é‡Šï¼Œæ‰€ä»¥æˆ‘ä¸¾äº†å‡ ä¸ªæ¯”è¾ƒå…·è±¡çš„ä¾‹å­ã€‚

æœ€åï¼Œå› ä¸ºåœ¨ Stable Diffusion é‡Œï¼Œåªç”¨åˆ°äº† CLIP çš„ Text Encoder çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥åœ¨ä¸€äº›äº§å“é‡Œï¼Œè¿™ä¸ªåˆç§°ä¸º CLIP Text Encoderï¼Œæˆ–è€… CLIP Text Encodeã€‚

> [!faq]
> ä¸ºä½•ä½¿ç”¨ Stable Diffusion æˆ–è€… Midjourney æ—¶ï¼Œè¾“å…¥çš„ Prompt ä¸éœ€è¦åœ¨æ„è¯­æ³•ï¼Ÿä»¥åŠå¤§å°å†™ä¸æ•æ„Ÿå‘¢ï¼Ÿå› ä¸ºè¿™äº› Prompt éƒ½ä¼šè¢« Text Encoder è½¬æˆç‰¹å¾å‘é‡ï¼Œè¯­æ³•ã€å¤§å°å†™è¢«è½¬æˆç‰¹å¾å‘é‡åï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸²æ•°å­—äº†ï¼Œåœ¨æ²¡æœ‰å¯¹æ¨¡å‹è¿›è¡Œè°ƒæ•´çš„æƒ…å†µä¸‹ï¼Œè¿™äº›éƒ½ä¸å¤ªæ•æ„Ÿäº†ã€‚

## Refer

<https://www.comflowy.com/zh-CN/basics/stable-diffusion-foundation>

- [Stable Diffusion Art - Tutorials, prompts and resources](https://stable-diffusion-art.com/)
